# Principles and Practices of Chromatic Adaptation

Colorimetry provides a scientific and quantitative way to measure and compare color. By specifying a set of primaries (e.g., RGB or XYZ) and the tristimulus values, we could tell whether two light stimuli will generate the same color perception. However, colorimetry works best for a fixed viewing condition. Thus, the change of viewing condition requires modeling various factors in viewing condition, one of which is the viewing illuminant.

The significance of the viewing illuminant is that human beings change their color perception by adapting to the color of the illuminant through a process known as *chromatic adaptation*. Chromatic adaptation is fascinating; it's rooted in fundamental neuroscience and at the same time has wide applications in practice. This article describes some interesting and perhaps confusing aspects of chromatic adaptation, and discusses a few applications of chromatic adaptation.

## 1. Principles of von Kries Chromatic Adaptation

We provide a brief account for chromatic adaptation first. There are many excellent resources that provide a comprehensive treatment of chromatic adaptation. Two references that I find helpful are [Color Imaging: Fundamentals and Applications](https://dl.acm.org/doi/book/10.5555/1386684) by Reinhard et al., and of course [Color Appearance Models](https://onlinelibrary.wiley.com/doi/book/10.1002/9781118653128) by Fairchild.

In everyday life we encounter a wide range of viewing environments, each of which has a different illuminant ranging from incandescent light to daylight, but we have relatively constant visual experience. For instance, a piece of white paper or a white wall will appear the same white color to you whether you view it under incandescent light or under noon sunlight. This is because our visual system adapts to the illuminant insofar as we could discount the (color of the) illuminant to some extent, i.e., chromatic adaptation. Note that there are other forms of adaptation. For instance, we adapt to very dark or very bright environments, giving rise to the notions of light and dark adaptation, respectively. This article focuses on chromatic adaptation.

### 1.1 The Theory

How do we adapt? [Johannes von Kries](https://en.wikipedia.org/wiki/Johannes_von_Kries) hypothesized that we adapt by scaling the responses of the three types of cone under different illuminants, each of which scales independently. In matrix form, von Kries adaptation is expressed as the following equation, where [L, M, S]<sup>T</sup> represents the unadapted cone responses of the neutral point, [L<sub>a</sub>, M<sub>a</sub>, S<sub>a</sub>]<sup>T</sup> represents the adapted cone responses, and &alpha;, &beta;, &gamma; are the scaling factors (gains) of each cone type, respectively.

<img src="https://latex.codecogs.com/svg.latex?\begin{bmatrix}&space;L_a\\&space;M_a\\&space;S_a\\&space;\end{bmatrix}&space;=&space;\begin{bmatrix}&space;\alpha,~0,~0\\&space;0,~\beta,~0\\&space;0,~0,~\gamma\\&space;\end{bmatrix}&space;\times&space;\begin{bmatrix}&space;L\\&space;M\\&space;S\\&space;\end{bmatrix}" title="\begin{bmatrix} L_a\\ M_a\\ S_a\\ \end{bmatrix} = \begin{bmatrix} \alpha,~0,~0\\ 0,~\beta,~0\\ 0,~0,~\gamma\\ \end{bmatrix} \times \begin{bmatrix} L\\ M\\ S\\ \end{bmatrix}" />

How exactly does each cone type scale? That is, what are the values of &alpha;, &beta;, and &gamma;? von Kries’ theory is that the cone responses scale in such a way that a neutral point appears the same color under different illuminants. This basic assumption/observation would allow us to determine the scaling factors, as will see next.

But first of all, what is a neutral point? A neutral point is a point that reflects all wavelengths equally without loss of energy. That is, the spectral reflectance of a neutral point is universally 1. From the colorimetry perspective, the color of a neutral point is obviously the color of the illuminant itself. This is because <code>&int;&Phi;(&lambda;)**R**(&lambda;)**L**(&lambda;)d&lambda; = &int;&Phi;(&lambda;)**L**(&lambda;)d&lambda;</code> when **R**(&lambda;) is 1 for all &lambda;s. A neutral point is sometimes also called a perfectly white diffuser. Since common illuminants appear white-ish, the color of the neutral point under a given illuminant is also called the white point of the illuminant.

While in reality no material is truly a perfectly white diffuser, a piece of white paper or a white wall comes close. That’s why you will often hear people say things like “white always appears white under different lights.” What they really mean, in precise terms, is that the neutral point maintains a constant perceived color under different illuminants.

Another way to look at this neutral point color constancy assumption is that the cone responses of a neutral point, after adaptation, are constant, independent of an illuminant. Taking this perspective, it’s easy to calculate the scaling factors. Here is the idea. Let’s use [L<sub>w</sub>, M<sub>w</sub>, S<sub>w</sub>]<sup>T</sup> to denote the unadapted cone responses of the illuminant itself. The unadapted cone responses of the neutral point under this illuminant must be [L<sub>w</sub>, M<sub>w</sub>, S<sub>w</sub>]<sup>T</sup> too, based on the definition of a neutral point. The neutral point color constancy basically states that the adapted responses of the neutral point under this illuminant, [L<sub>a</sub>, M<sub>a</sub>, S<sub>a</sub>]<sup>T</sup>, should be constant, i.e., independent of [L<sub>w</sub>, M<sub>w</sub>, S<sub>w</sub>]<sup>T</sup>. Let’s say the constant adapted responses are [Q, P, R]<sup>T</sup>, where Q, P, and R are just three constants.

Out of mathematical convenience, we’ll use 1 for Q, P, and R. As a result:

&alpha; = 1/L<sub>w</sub>

&beta; = 1/M<sub>w</sub>

&gamma; = 1/S<sub>w</sub>

This gives the familiar chromatic adaptation equation below, where &Phi;<sub>w</sub> denotes the SPD of the illuminant. As we will see later, the exact numerical values of the constants are not important for practical applications.

<img src="https://latex.codecogs.com/svg.latex?\begin{bmatrix}&space;L_a\\&space;M_a\\&space;S_a\\&space;\end{bmatrix}&space;=&space;\begin{bmatrix}&space;\frac{1}{L_w},&space;0,&space;0\\&space;0,&space;\frac{1}{M_w},&space;0\\&space;0,&space;0,&space;\frac{1}{S_w}\\&space;\end{bmatrix}&space;\times&space;\begin{bmatrix}&space;L\\&space;M\\&space;S\\&space;\end{bmatrix}&space;,~~where&space;\begin{bmatrix}&space;L_w\\&space;M_w\\&space;S_w\\&space;\end{bmatrix}&space;=&space;\begin{bmatrix}&space;\int\Phi_w(\lambda)L(\lambda)d\lambda\\&space;\int\Phi_w(\lambda)M(\lambda)d\lambda\\&space;\int\Phi_w(\lambda)S(\lambda)d\lambda\\&space;\end{bmatrix}" title="\begin{bmatrix} L_a\\ M_a\\ S_a\\ \end{bmatrix} = \begin{bmatrix} \frac{1}{L_w}, 0, 0\\ 0, \frac{1}{M_w}, 0\\ 0, 0, \frac{1}{S_w}\\ \end{bmatrix} \times \begin{bmatrix} L\\ M\\ S\\ \end{bmatrix} ,~~where \begin{bmatrix} L_w\\ M_w\\ S_w\\ \end{bmatrix} = \begin{bmatrix} \int\Phi_w(\lambda)L(\lambda)d\lambda\\ \int\Phi_w(\lambda)M(\lambda)d\lambda\\ \int\Phi_w(\lambda)S(\lambda)d\lambda\\ \end{bmatrix}" />

The von Kries chromatic adaptation model ensures that a neutral point does have a constant color appearance under different illuminants. This is obvious from the equation below, where [L<sub>w1</sub>, M<sub>w1</sub>, S<sub>w1</sub>]<sup>T</sup> and [L<sub>w2</sub>, M<sub>w2</sub>, S<sub>w2</sub>]<sup>T</sup> are two arbitrary illuminants w1 and w2.

<img src="https://latex.codecogs.com/svg.latex?\begin{bmatrix}&space;\frac{1}{L_{w1}},&space;0,&space;0\\&space;0,&space;\frac{1}{M_{w1}},&space;0\\&space;0,&space;0,&space;\frac{1}{S_{w1}}\\&space;\end{bmatrix}&space;\times&space;\begin{bmatrix}&space;L_{w1}\\&space;M_{w1}\\&space;S_{w1}\\&space;\end{bmatrix}&space;=&space;\begin{bmatrix}&space;\frac{1}{L_{w2}},&space;0,&space;0\\&space;0,&space;\frac{1}{M_{w2}},&space;0\\&space;0,&space;0,&space;\frac{1}{S_{w2}}\\&space;\end{bmatrix}&space;\times&space;\begin{bmatrix}&space;L_{w2}\\&space;M_{w2}\\&space;S_{w2}\\&space;\end{bmatrix}" title="\begin{bmatrix} \frac{1}{L_{w1}}, 0, 0\\ 0, \frac{1}{M_{w1}}, 0\\ 0, 0, \frac{1}{S_{w1}}\\ \end{bmatrix} \times \begin{bmatrix} L_{w1}\\ M_{w1}\\ S_{w1}\\ \end{bmatrix} = \begin{bmatrix} \frac{1}{L_{w2}}, 0, 0\\ 0, \frac{1}{M_{w2}}, 0\\ 0, 0, \frac{1}{S_{w2}}\\ \end{bmatrix} \times \begin{bmatrix} L_{w2}\\ M_{w2}\\ S_{w2}\\ \end{bmatrix}" />

However, other (non-neutral/white) colors, albeit adapted, are *not* perfectly adapted. This can be seen from the following inequality, where [L<sub>w1</sub>, M<sub>w1</sub>, S<sub>w1</sub>]<sup>T</sup> and [L<sub>w2</sub>, M<sub>w2</sub>, S<sub>w2</sub>]<sup>T</sup> again are two arbitrary illuminants w1 and w2, respectively, and [L<sub>1</sub>, M<sub>1</sub>, S<sub>1</sub>]<sup>T</sup> and [L<sub>2</sub>, M<sub>2</sub>, S<sub>2</sub>]<sup>T</sup> are the unadapted responses of a non-neutral material under the two illuminants, respectively. Note that the equation doesn’t hold for non-neutral material, suggesting that the color appearance of an arbitrary point won’t be constant. Intuitively, while an apple is seen as red-ish both under incandescent and daylight, you could probably still tell the slight difference.

Critically, von Kries chromatic adaptation operates in the LMS cone space. That is, the chromatic adaptation matrix is applied to the cone responses. If a color stimulus is expressed in other color spaces, e.g., CIE XYZ, we would have to first transform the color to the cone space before the precise von Kries adaptation can be applied.

Finally, it is worth noting that in practice we don’t fully adapt even for white colors either. However, von Kries chromatic adaptation works remarkably well in most cases, and is what we will assume for the rest of this article. More complicated chromatic adaptation mechanisms can be found in [Reinhard et al. 2008](https://dl.acm.org/doi/book/10.5555/1386684) and [Fairchild 2013](https://onlinelibrary.wiley.com/doi/book/10.1002/9781118653128).

## 1.2 From Chromatic Adaptation to Color Appearance Models

Hopefully it is clear by now that colorimetry itself can’t fully explain subjective color perception, which depends on not only the XYZ tristimulus values of a color stimulus but also the viewing condition. Chromatic adaptation moves one step toward subjective color perception by considering the illuminant.

Illuminant, however, is just one aspect of viewing condition. In reality, many other aspects of the viewing condition will affect the color perception. For instance, the immediate proximal field and the background of the color stimulus would also affect the color perception. The best example is perhaps the simultaneous lightness contrast effect (Figure 11.7 in [Reinhard et al. 2008](https://dl.acm.org/doi/book/10.5555/1386684)).

The previous adaptation states, i.e., the recent history of viewing conditions, also affect the color perception. A clever demonstration is the recent finding that [chromatic adaptation is irreversible](https://onlinelibrary.wiley.com/doi/abs/10.1002/col.22228).

The subjective color perception is also very much dependent on the cognitive state of the observer. For instance, when observing an orange-ish wall, the color perception will be very different if the observer thinks the wall itself is orange to begin with versus if the observer thinks that the wall is being illuminated by street lights. [Figure 11.6 in Reinhard et al.]

Color appearance model comprehensively takes into account different aspects of the viewing condition, which is beyond the scope of this article. We here focus on just the chromatic adaptation aspect of color appearance modeling.

## 1.3 Emissive vs. Reflective Media

Sometimes you will see people say that we adapt to the white point of a color space, or we adapt to the white point of a display. What do they mean? Don’t we adapt to the illuminant? Why all of a sudden we are adapting to the display or a color space?

It turns out the way we adapt changes slightly depending on whether we are looking at an emissive media, e.g., a computer display, versus a reflective media, e.g., a piece of white paper. When viewing a surface color, the observer is adapted to the surrounding illuminant. When viewing a display, the observer is (primarily) adapted to the display white point (i.e., the white point of the color space currently used by the display). 

For instance if we are viewing a display that uses the sRGB color space, we adapt to D65. Why so? Intuitively, we adapt to the display white point because that’s the prevailing/predominant color to the observer, similar to the effect of an illuminant. But what if a white pixel is not even presented to the viewer? How can we still adapt to the white point of the display? The explanation is debatable and sometimes a mystery, but [the theory](https://www.sciencedirect.com/science/article/pii/S2352154619300336) is that we could estimate the equivalent illuminant from familiar objects in the images, essentially a series of visual cues.

Since the reference white of a color space is usually chosen from the CIE Standard Illuminants, which closely resemble common light sources (see [Table 3](https://www.babelcolor.com/index_htm_files/A%20review%20of%20RGB%20color%20spaces.pdf) in an article from BabelColor), we sometimes just mix the two cases together. But they are different precisely speaking: one is adapting to the chosen reference white on a display device  (usually a standard illuminant), and the other is adapting to the light source.

One final note: when we look at a display under some illuminant, we actually have a “[mixed adaptation](https://www.osapublishing.org/oe/fulltext.cfm?uri=oe-27-3-2855&id=404429)”, which can be thought of as a weighted sum between adapting to the display white point and the illuminant. Roughly, the adaptation is weighted more toward the display white, but when the display is relatively dimmer and dimmer (e.g., viewing a smartphone display under sunlight), it might have less effect on adaptation. [Apple’s True Tone Display](https://www.pocket-lint.com/tablets/news/apple/137264-what-is-apple-true-tone-display) is partially based on the notion of mixed adaptation. True Tone displays try to provide a consistent color appearance across different lightning environments by [changing the display white according to the ambient lighting](https://onlinelibrary.wiley.com/doi/abs/10.1002/sdtp.13057).
